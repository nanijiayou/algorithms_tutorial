## 区间DP

### 定义
区间类动态规划是线性动态规划的扩展，它在分阶段的划分问题时，与阶段中元素出现的顺序和由前一阶段的哪些元素合并而来有很大的关系。  
令状态 $f_{i,j}$ 表示将下标位置 $i$ 到 $j$ 的所有元素合并能获得的最大价值，那么：
$$f_{i,j} = max\{f_{i,k}, f_{k+1,j} + cost \}$$
其中，cost 为将这两组元素合并起来的代价。

#### 区间DP特点：
能将问题分解为能两两合并的形式。

#### 求解
对整个问题设最优解，枚举合并点，将问题分解为左右两个部分，然后合并两个部分的最优解得到原问题的最优解。

#### 例子
```
石子和并：

将 n 堆石子绕圆形操场排放，现要将石子有序地合并成一堆。规定每次只能选相邻的两堆合并成新的一堆，并将新的一堆的石子数记做该次合并的得分。

请编写一个程序，读入堆数 n 及每堆的石子数，并进行如下计算：
选择一种合并石子的方案，使得做 n 次合并得分总和最大。
```

**考虑不在环上**：

令 $f_{i,j} 表示将区间[i,j]，内所有的石子合并到一起的最大得分$，转移方程为：
$$f_{i,j} = max(f_{i,k} + f_{k+1, j} + \sum_{t=i}^{j}a_t)$$
令 $sum_i$ 表示数组的前缀和，状态转移方程可以改为：
$$ f_{i,j} = max(f_{i,k} + f_{k+1, j} + sum_j - sum_{i-1}) $$

**如何进行状态转移**

由于计算 $f_{i,j}$ 需要知道所有 $f_{i,k}$ 和 $f_{k+1,j}$ 的值，而这两个中包含的元素的数量都小于 $f_{i,j}$ ，所以我们以 $len = j-i+1$ 作为 DP的阶段。首先从小到大枚举 $len$，然后枚举 $i$ 的值，根据 $len$ 和 $i$ 的公式计算出 $j$ 的值，然后枚举 $k$。时间复杂度为 $O(n^3)$。

**环的处理**

  1. 石子组成一个环，可以分开枚举分开的位置，将环转化为一个链，由于要枚举 $n$ 次，时间复杂度为 $O(n^4)$ 
  2. 将这条链延长2倍，变成 $2 \times n$ 堆石子，其中第 $i$ 堆与第 $n+i$ 堆相同。DP求解后，取 $f_{1,n}, f_{2,n+1}, ... , f_{i, n + i -1}$ 中的最优值即可，复杂度为$O(n^3)$。

**核心代码**
```
  for(len = 1; len <= n; len++)
    for(i = 1; i <= 2*n - 1; i++)
      int j = len + i - 1;
      for(k = i; k < j && k <= 2*n - 1; k++) 
        f[i][j] = max(f[i][j], f[i][k] + f[k+1][j] + sum[j] - sum[i-1]);
```